<?php defined('BASEPATH') OR exit('No direct script access allowed');class Dashboard extends Admin_controller {    function __construct() {        parent::__construct();        $this->load->helper('dashboard');    }    public function index() {        $data = [            'admin_block' => '',            'teacher_block' => '',            'assessor_block' => '',            'role_name' => getRoleName( $this->role_id ),        ];        if( in_array($this->role_id, [1,2,8]) ){            $data['admin_block'] = $this->admin();        }                              if ( $this->role_id == 3 ){            $data['teacher_block'] = $this->teacher();        }        if ( $this->role_id == 4 ){            $data['assessor_block'] = $this->assessor();        }                        $this->viewAdminContent('dashboard', $data);        }        public function admin(){                $data = [            'student'               => $this->count_student(),            'teacher'               => $this->count_teacher(),                       'pending_student_qty'   => $this->count_pending_enrolled_student(),                       'exam_sch'              => $this->count_exam_schedule(),                   'enrolled_students'     => $this->getPendingEnrolledStudents(),                   'upcoming_mock_exam'    => $this->getUpcomingExams()          ];                return $this->load->view('dashboard/block/admin', $data, true );           }        public function getPendingEnrolledStudents(){           $this->load->model('Dashboard_model');                $page   = (int) $this->input->get('p');                $target = build_pagination_url('admin/db/get_student', 'p', true);        $limit  = 10;        $start  = startPointOfPagination($limit,$page);                $total      = $this->Dashboard_model->total_pending_enrolled();        $students   = $this->Dashboard_model->get_pending_enrolled_list( $limit, $start );                                if($students){            $data['sl'] = $start;            $data['pagination'] = getPaginator($total, $page, $target, $limit );                  $data['students'] = $students;            $view = $this->load->view('dashboard/block/admin_awiting_students', $data, true );                                     if( $this->input->is_ajax_request() ){                echo $view;            } else {                return $view;            }        }                          }        private function getUpcomingExams($limit = 10){                $this->db->select('es.id,es.datetime,cn.name as centre,es.label,es.gmc_exam_dates');        $this->db->select('e.name as name');        $this->db->from('exam_schedules as es');        $this->db->join('exam_centres as cn', 'cn.id=es.exam_centre_id', 'LEFT');        $this->db->join('exams as e', 'es.exam_id=e.id', 'LEFT');        $this->db->where('datetime >=', date('Y-m-d 00:00:0') );        $this->db->order_by('datetime', 'ASC');        $this->db->limit($limit);        $exams = $this->db->get()->result();                                 if($exams){            $data['sl'] = 1;            $data['exams'] = $exams;            return $this->load->view('dashboard/block/admin_upcoming_mock', $data, true );         }            }            public function teacher() {        $data[] = array();        return $this->load->view('dashboard/block/teacher', $data, true);           }        public function assessor() {        $this->db->select('name');        	$this->db->where('id', 'es.exam_id', false, false);        	$sql = $this->db->get_compiled_select('exams');        $this->db->select("es.id, ({$sql}) as name, es.datetime");                $this->db->select('ec.name as centre, ec.address');        $this->db->from('student_exams as se');        $this->db->join('exam_schedules as es', 'es.id=se.exam_schedule_id', 'LEFT');                $this->db->join('exam_centres as ec', 'ec.id=es.exam_centre_id', 'LEFT');                $this->db->where('es.datetime >=', date('Y-m-d 00:00:00', strtotime('+7 Days')));        $data['exams'] = $this->db->get()->result();           return $this->load->view('dashboard/block/assessor', $data, true );           }                private function count_student(){        $this->db->where('status','Active');        return $this->db->count_all_results('students');    }        private function count_teacher(){        $this->db->where('status','Active');        $this->db->where('role_id',3);        return $this->db->count_all_results('users');    }        private function count_pending_enrolled_student(){        return $this->db->where('status', 'Pending')->count_all_results('student_exams');    }        private function count_exam_schedule(){                return $this->db->count_all_results('exam_schedules');    }    }