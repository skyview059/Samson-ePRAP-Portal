<?php defined('BASEPATH') OR exit('No direct script access allowed'); ?><?php load_module_asset('mailer','css');?><section class="content-header">    <h1> Mailer  <small>Control panel</small></h1>    <ol class="breadcrumb">        <li><a href="<?php echo site_url(Backend_URL) ?>"><i class="fa fa-dashboard"></i> Admin</a></li>        <li class="active">Mailer</li>    </ol></section><section class="content"><form class="form-horizontal" id="sendForm" method="POST"      action="<?php echo Backend_URL . 'mailer/save_queue'; ?>">    <div class="row">        <div class="col-md-8">            <div class="box box-primary">                <div class="box-body">                                                            <div class="form-group  no-margin">                        <label for="title" class="control-label"  style="line-height: 2.5;">Email Subject :</label>                                                <input type="text" class="form-control" name="title"                                id="title" placeholder="Subject"                               value="<?php echo $subject; ?>" />                    </div>                    <div class="form-group no-margin" style="padding-top: 15px;">                                <label for="template" class="control-label" style="line-height: 2.5;">Email Body: &nbsp;&nbsp;&nbsp; <em class="text-red pull-right">Use "%name%" for replace with student real name</em></label>                                                <textarea class="form-control" rows="4" name="template"                                   id="template" placeholder="Template"><?php echo $content; ?></textarea>                    </div>                </div>            </div>        </div>        <div class="col-md-4" id="mailer_tab">            <p class="hidden">                number_type [ GMC, GDC, NMC ]<br/>                gender [ Male, Female ]<br/>                                        contact_by_rm [ Yes, No ]<br/>                status [Pending, Active, Inactive, Archive]<br/>                Exam Centre [ DB ]<br/>                Mock Exam [ PLAB Part-2, ORE Part 2, MRCP Part 2 etc (DB)  ]<br/>                Has Job Profile [ Yes, No ]<br/>                 if has Job Profile then By Job  Specialty [ Select form DB ]<br/>                                     </p>                        <div class="nav-tabs-custom">                <ul class="nav nav-tabs">                    <li class="active">                        <a href="#general" class="mailer_type" data-name="general" data-toggle="tab" aria-expanded="true">                            General                        </a>                    </li>                    <li class="">                        <a href="#job" class="mailer_type" data-name="job" data-toggle="tab" aria-expanded="false">                            Job Notification                        </a>                    </li>                                                          </ul>                <div class="tab-content">                                        <div class="col-md-12">                        <div class="form-group">                                                    <div class="input-group">                                <span class="input-group-addon">Occupation:</span>                                <select name="number_type" id="number_type" class="form-control">                                    <?php echo selectOptions('', [                                        '0' => '--All--',                                        'GMC' => 'Doctor',                                        'NMC' => 'Nurse',                                        'GDC' => 'Dentist',                                    ]); ?>                                </select>                            </div>                                                </div>                     </div>                                         <div class="tab-pane active clearfix" id="general">                                                                                            <div class="col-md-12">                                                            <div class="form-group">                                                        <div class="input-group">                                    <span class="input-group-addon">Mock Exam:</span>                                    <select name="exam_id" id="exam_id" class="form-control">                                        <?php echo getByExam(); ?>                                                                        </select>                                </div>                                                    </div>                            <div class="form-group">                                                        <div class="input-group">                                    <span class="input-group-addon">Till Exam Date: </span>                                    <input type="text" name="till_exam_date" class="form-control js_datepicker"/>                                    <span class="input-group-addon">Students</span>                                </div>                                                    </div>                            <div class="form-group">                                                        <div class="input-group">                                    <span class="input-group-addon">Exam Centre:</span>                                    <select name="centre_id" id="centre_id" class="form-control">                                        <?php echo getByCentre(); ?>                                                                        </select>                                </div>                                                    </div>                                                        <div class="form-group">                                                        <div class="input-group">                                    <span class="input-group-addon">Student :</span>                                    <select name="case" id="case" class="form-control">                                        <?php echo send_type(); ?>                                    </select>                                </div>                            </div>                        </div>                        <div class="custom_date col-md-12">                            <div class="form-group">                                                            <div class="input-group">                                    <span class="input-group-addon"><i class="fa fa-calendar"></i> Form Date</span>                                    <input  name="from_date" autocomplete="new-password" id="from_date" class="form-control js_datepicker" />                                </div>                                                                    </div>                            <div class="form-group">                                                            <div class="input-group">                                    <span class="input-group-addon"><i class="fa fa-calendar"></i> To Date</span>                                    <input name="to_date" autocomplete="new-password"  id="to_date" class="form-control js_datepicker" />                                </div>                                                                    </div>                        </div>                        <div class="student_search">                            <div class="input-group">                                                                <input type="text" name="keyword"                                        id="keyword" class="form-control"                                        autocomplete="off"                                       placeholder="Search for...">                                <span class="input-group-btn">                                    <span class="btn btn-primary" id="search">                                        <i class="fa fa-search"></i>                                                                  </span>                                </span>                                                            </div>                            <div class="input-group">                                <p>                                    <em class="text-red" style="font-size:11pt; font-weight: bold;">                                        Search result will append to bottom                                    </em>                                                                    <span id="clear_txt" class="text-blue btn btn-link">                                        <i class="fa fa-times"></i>                                        Clear                                     </span>                                </p>                            </div>                            <div class="custom_students">                                <div class="student_response"></div>                                <div class="searched_responsed"></div>                            </div>                        </div>                                        </div>                                        <div class="tab-pane clearfix" id="job">                        <div class="col-md-12">                            <div class="form-group">                                                        <div class="input-group">                                    <span class="input-group-addon">Gender :</span>                                    <select name="gender" id="gender" class="form-control">                                        <?php echo selectOptions('', [                                            '0' => '--All--',                                            'Male' => 'Male',                                            'Female' => 'Female',                                                                                ]); ?>                                    </select>                                </div>                                                    </div>                            <div class="form-group">                                                        <div class="input-group">                                    <span class="input-group-addon">Contact by RM :</span>                                    <select name="contact_by_rm" id="contact_by_rm" class="form-control">                                        <?php echo selectOptions('', [                                            '0' => '--All--',                                            'Yes' => 'Yes',                                            'No' => 'No',                                                                                ]); ?>                                    </select>                                </div>                                                    </div>                            <div class="form-group">                                                        <div class="input-group">                                    <span class="input-group-addon">Has Job Profile :</span>                                    <select name="job_profile" id="job_profile" class="form-control">                                        <?php echo selectOptions('', [                                            '0' => '--All--',                                            'Yes' => 'Yes',                                            'No' => 'No',                                                                                ]); ?>                                    </select>                                </div>                                                    </div>                                                        <div class="form-group">                                                                <label class="col-md-12 no-paddng" id="mark_all">Job Specialty (Mark All)</label>                                <div class="col-md-12" id="specialty_box">                                                                    <?= getJobSpecialties(); ?>                                                                </div>                            </div>                        </div>                    </div>                                            </div>                <div class="box-footer">                    <div class="row">                        <div class="col-md-6">                            <div class="hidden load_more_buttons">                                <button type="button" onclick="load_more(0, 20);" class="btn btn-primary load_more">                                    <i class="fa fa-refresh"></i>                                    More                                </button>                                <button type="button" id="clear2" class="btn btn-warning">                                    <i class="fa fa-times"></i>                                    Clear                                </button>                            </div>                        </div>                        <div class="col-md-6 text-right">                               <input type="hidden" name="type" id="type" value="general"/>                            <button type="button" onclick="return submit_mail();"                                    class="btn btn-primary">Save Mail Queue</button>                         </div>                    </div>                                    </div>            </div>                                </div>    </div></form></section><?php loadCKEditor5ClassicBasic(['#template']); ?><script src="https://cdn.ckeditor.com/4.7.3/standard/ckeditor.js"></script><script>    $(document).on('click', '#mark_all', function(){                var len = $("input[name='job_specialty_ids[]']:checked").length;                    if (len) {            $('.specialty_ids').prop('checked', '');        } else {            $('.specialty_ids').prop('checked', 'checked');        }                });        $(document).on('change', '#case', function(){        var type = $(this).val();                $('.custom_date').css('display','none');        $('.load_more_buttons').addClass('hidden');        $('.student_search').css('display','none');                if (type === 'custom_dates') {            $('.custom_date').slideDown('slow');            $('.student_search').slideUp('slow');            $('.student_response').empty();        } else if (type === 'custom_student') {                        $('.custom_date').slideUp('slow');            $('.custom_students').slideDown('slow');            $('.student_search').slideDown('slow');            $('.load_more_buttons').removeClass('hidden');            load_more(0, 20);        } else {                        $('.student_search').slideUp('slow');            $('.custom_date').slideUp('slow');                        $('.student_response').empty();        }    });    function submit_mail() {        var subject = $('#title').val();        $('#title').parent().find('p').remove();        if(!subject){            $('#title').after('<p class="text-red text-bold">Please enter subject</p>');            return false;        } else {            $('#title').after().find('p').remove();        }                var yes = confirm('Confirm Create Mail Queue');                if (yes) {            CKupdate();            $('#sendForm').submit();        }    }    function load_more(start, limit) {        $.ajax({            url: "<?php echo Backend_URL; ?>mailer/get_students?start=" + start + "&limit=" + limit,            type: 'GET',            cache: false,            dataType: 'json',            success: function (res) {                if (res.Status === 'OK') {                    $(".student_response").append(res.Msg);                    $(".load_more").attr('onclick', res.Button);                }            }        });    }    $(document).on('click', '#search', function (){        var key = $('#keyword').val();        $.ajax({            url: "<?php echo Backend_URL; ?>mailer/getStudents?keyword=" + key,            type: 'GET',            cache: false,            dataType: 'json',            success: function (res) {                if (res.Status === 'OK') {                    $('.custom_students').addClass('searched_students');                    $(".searched_responsed").append(res.Msg);                }            }        });    });        $(document).on('keypress', '#keyword', function (e){                        var unicode = e.charCode ? e.charCode : e.keyCode;                if( unicode === 13 ){ $('#search').click(); }    });        $(document).on('click', '#clear2, #clear_txt', function (){                $(".searched_responsed").empty();        $(".student_response").empty();    });    function CKupdate() {        for (instance in CKEDITOR.instances){            CKEDITOR.instances[instance].updateElement();        }    }        $(document).on('click', '.mailer_type', function (){                var tabe_name = $(this).attr('data-name');        $("#type").val(tabe_name);    });        </script>